<app-navbar></app-navbar>
<div class="min-h-screen mt-24 flex items-center justify-center">
  <div class="my-4 mx-auto w-10/12 bg-white shadow-md rounded-lg overflow-hidden">
    <div *ngIf="!isInitialized" class="p-12">
      <div class="w-full text-center">
        <i class="animate-spin text-gray-300 fa-solid fa-circle-notch" style="font-size: 36px;"></i>
      </div>
    </div>
    <div *ngIf="isInitialized" class="p-12">
      <div class="mb-4">
        <a href="/searchNCR" class="text-lg text-cyan-600 decoration-inherit hover:text-cyan-800 hover:underline">< Back</a>
      </div>
      <div class="mb-8 p-12 rounded-lg shadow-md shadow-black outline outline-1 outline-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 text-center justify-center mb-8 uppercase">NCR Detail</h2>
        <div *ngIf="ncrData.regulationbased === 'DGCA'" class="grid grid-cols-2 gap-4 mb-4">
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit Plan Number:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_plan_no}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Regulation Based on:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.regulationbased}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">NCR Number:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.ncr_no}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Issued Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.issued_date}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit Type & Scope:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_type}} / {{ncrData.audit_scope}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Sent to:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.to_uic}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Responsible Office:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.responsibility_office}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">With Attention to:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.attention}}</label>
          </div>
          <div class="col-span-2 space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Required Condition Reference:</label>
            <label class="tracking-wide text-gray-600 text-left text-wrap">{{ncrData.require_condition_reference}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Level of Finding:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.level_finding}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Problem Analysis:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.pa_requirement}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Answer Due Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.answer_due_date}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">IAN Number (if there is IAN issued):</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.ian_no}}</label>
          </div>
          <div class="col-span-2"><label class="tracking-wide font-semibold text-gray-700 text-left">Encountered Condition:</label></div>
          <div class="col-span-2"><p class="tracking-wide text-gray-600 text-left text-wrap">{{ncrData.encountered_condition}}</p></div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit by:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_by}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Acknowledged by:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.acknowledge_by}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_date}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Acknowledged Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.acknowledge_date}}</label>
          </div>
          <div class="col-span-2 space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Status:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.status}}</label>
          </div>
        </div>
        <div *ngIf="ncrData.regulationbased === 'EASA'" class="grid grid-cols-2 gap-4 mb-4">
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit Plan Number:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_plan_no}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Regulation Based on:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.regulationbased}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">NCR Number:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.ncr_no}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Issued Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.issued_date}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit Type & Scope:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_type}} / {{ncrData.audit_scope}}</label>
          </div>
          <!-- <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Sent to:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.to_uic}}</label>
          </div> -->
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Responsible Office:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.responsibility_office}}</label>
          </div>
          <!-- <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">With Attention to:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.attention}}</label>
          </div> -->
          <div class="col-span-2 space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Required Condition Reference:</label>
            <label class="tracking-wide text-gray-600 text-left text-wrap">{{ncrData.require_condition_reference}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Level of Finding:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.level_finding}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Problem Analysis:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.pa_requirement}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Answer Due Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.answer_due_date}}</label>
          </div>
          <!-- <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">IAN Number (if there is IAN issued):</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.ian_no}}</label>
          </div> -->
          <div class="col-span-2"><label class="tracking-wide font-semibold text-gray-700 text-left">Encountered Condition:</label></div>
          <div class="col-span-2"><p class="tracking-wide text-gray-600 text-left text-wrap">{{ncrData.encountered_condition}}</p></div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit by:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_by}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Acknowledged by:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.acknowledge_by}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Audit Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.audit_date}}</label>
          </div>
          <div class="space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Acknowledged Date:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.acknowledge_date}}</label>
          </div>
          <div class="col-span-2 space-x-2">
            <label class="tracking-wide font-semibold text-gray-700 text-left">Status:</label>
            <label class="tracking-wide text-gray-600 text-left">{{ncrData.status}}</label>
          </div>
        </div>
        <div class="flex flex-center mb-4 space-x-2">
          <button (click)="navigatePreview()" class="inline-block bg-[#016299] rounded border-2 border-primary px-3 pb-[6px] pt-2 font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
            <i class="far fa-file-pdf pr-2" style="font-size: 16px;"></i>Preview
          </button>
          <button (click)="navigateEditNCR()" class="inline-block bg-[#016299] rounded border-2 border-primary px-4 pb-[6px] pt-2 font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white" *ngIf="role === 'Admin' || role === 'IM'">
            <i class="fas fa-edit pr-2" style="font-size: 16px;"></i> Edit
          </button>
        </div>
      </div>

      <div class="mb-8 p-12 rounded-lg shadow-md shadow-black outline outline-1 outline-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 text-center justify-center mb-8 uppercase">Reply</h2>
        <div class="mt-5">
          <button (click)="navigateAddReply()" class="inline-block bg-[#016299] rounded border-2 border-primary px-3 pb-[6px] items-center pt-2 font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
            <i class="fa-solid fa-plus pr-2"></i>Add Reply
          </button>
        </div>
        <div class="show-table mt-5 border border-gray-500">
          <div class="table-responsive overflow-auto "style="max-height: 600px; min-height: 200px;">
            <table class="table w-full bg-white overflow-y-scroll text-sm" id="data-table">
              <thead class="bg-blue-100 font-medium">
                <tr class="border-b border-gray-500">
                  <th id="identified_by" class="px-4 py-2 border-r border-gray-500">Identified by</th>
                  <th id="identified_date" class="px-4 py-2 border-r border-gray-500">Identification Date</th>
                  <th id="accept_by" class="px-4 py-2 border-r border-gray-500">Audit Accepted by</th>
                  <th id="accept_date" class="px-10 py-2 border-r border-gray-500">Audit Accept Date</th>
                  <th id="reply_detail" class="px-10 py-2 border-r border-gray-500">Details</th>
                  <th id="action" class="px-4 py-2">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of replyNCR; let i = index" class="border-b border-gray-500">
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.identified_by_auditee }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.identified_date }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.accept_by_auditor }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.auditor_accept_date }}</td>
                  <td class="px-4 py-2 border-r border-gray-500 text-center">
                    <details id="reply_details_{{i+1}}" class="open">
                      <summary class="inline-block bg-[#016299] rounded border-2 border-primary px-4 pb-[6px] pt-2 text-xs font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 cursor-pointer focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
                        Details
                      </summary>

                      <div class="bg-white shadow-md outline outline-1 outline-gray-700 rounded-lg w-fit max-w-[60%] h-fit my-auto mx-auto fixed inset-0 text-gray-600 p-16">
                        <span (click)="closeDetails('reply_details_' + (i+1))"
                            class="bg-gray-400 rounded-full flex items-center justify-center text-3xl font-bold uppercase absolute -right-4 -top-4 w-10 h-10 text-white hover:bg-blue-200 hover:duration-200 cursor-pointer">
                            X
                        </span>
                        <div class="grid gap-4">
                          <div class="space-y-2">
                            <label class="block tracking-wide text-gray-700 text-base font-semibold text-left">Root Cause of Problem:</label>
                            <p class="tracking-wide text-gray-600 text-base text-left">{{item.rca_problem}}</p>
                          </div>
                          <div class="space-y-2">
                            <label class="block tracking-wide text-gray-700 text-base font-semibold text-left">Corrective Actions:</label>
                            <p class="tracking-wide text-gray-600 text-base text-left">{{item.corrective_action}}</p>
                          </div>
                          <div class="space-y-2">
                            <label class="block tracking-wide text-gray-700 text-base font-semibold text-left">Preventive Actions:</label>
                            <p class="tracking-wide text-gray-600 text-base text-left">{{item.preventive_action}}</p>
                          </div>
                        </div>
                    </div>
                    </details>
                  </td>
                  <td class="px-4 py-2 text-center">
                    <!-- <button (click)="navigatePreview(replyNCR.documentid)" class="inline-block bg-[#016299] rounded border-2 border-primary px-3 pb-[6px] pt-2 text-xs font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">Preview</button> -->
                    <button (click)="navigateEditReply(item.id_ncr_reply)" class="inline-block bg-[#016299] rounded border-2 border-primary px-4 pb-[6px] pt-2 text-xs font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
                      <i class="fas fa-edit" style="font-size: 12px;"></i> Edit
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="flex mt-4 justify-center">
          <details id="export_excel_result" class="w-fit open">
            <summary (click)="exportToExcel('export-reply-table')" class="inline-block text-white justify-center bg-[#107c41] hover:bg-[#185c37] focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg px-4 py-2 motion-reduce:transition-none cursor-pointer">
              <i class="fas fa-file-excel text-white mr-2"></i>Export to Excel
            </summary>
  
            <div class="hidden bg-white outline outline-1 outline-gray-700 rounded-lg w-fit max-w-[80%] h-fit my-auto mx-auto fixed inset-0 text-gray-600 p-16">
              <div class="show-table mt-5 border border-gray-500">
                <div class="table-responsive overflow-auto" style="max-height: 600px; min-height: 200px;">
                  <table class="table w-full bg-white overflow-y-scroll text-sm" id="export-reply-table">
                    <thead class="bg-blue-100 font-medium">
                      <tr class="border-b border-gray-500">
                        <th id="rca_problem" class="px-4 py-2 border-r border-gray-500">Root Cause of Problem</th>
                        <th id="identified_by" class="px-4 py-2 border-r border-gray-500">Identified by</th>
                        <th id="identified_date" class="px-4 py-2 border-r border-gray-500">Identified Date</th>
                        <th id="corrective_action" class="px-4 py-2 border-r border-gray-500">Corrective Actions</th>
                        <th id="preventive_action" class="px-4 py-2 border-r border-gray-500">Preventive Actions</th>
                        <th id="accept_by" class="px-4 py-2 border-r border-gray-500">Accepted by</th>
                        <th id="accept_date" class="px-4 py-2 border-r border-gray-500">Accepted Date</th>
                        <th id="temporarylink" class="px-4 py-2">Temporary Link</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of replyNCR" class="border-b border-gray-500">
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.rca_problem }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.identified_by_auditee }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.identified_date }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.corrective_action }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.preventive_action }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.accept_by_auditor }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.auditor_accept_date }}</td>
                        <td class="px-4 py-2">{{ item.temporarylink }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>

      <div class="mb-8 p-12 rounded-lg shadow-md shadow-black outline outline-1 outline-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 text-center justify-center my-6 uppercase py-3">Result</h2>
        <div class="mt-5">
          <button (click)="navigateAddResult()" class="inline-block bg-[#016299] rounded border-2 border-primary px-3 pb-[6px] items-center pt-2 font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
            <i class="fa-solid fa-plus pr-2"></i>Add Result
          </button>
        </div>
        <div class="show-table mt-5 border border-gray-500">
          <div class="table-responsive overflow-auto "style="max-height: 600px; min-height: 200px;">
            <table class="table w-full bg-white overflow-y-scroll text-sm" id="data-table">
              <thead class="bg-blue-100 font-medium">
                <tr class="border-b border-gray-500">
                  <th id="proposed_by" class="px-4 py-2 border-r border-gray-500">Proposed by</th>
                  <th id="proposed_date" class="px-4 py-2 border-r border-gray-500">Proposed Date</th>
                  <th id="is_close" class="px-4 py-2 border-r border-gray-500">Close/Not</th>
                  <th id="effectiveness" class="px-10 py-2 border-r border-gray-500">Effectiveness</th>
                  <th id="rca_problem" class="px-4 py-2 border-r border-gray-500">New NCR Issue Number</th>
                  <th id="detail" class="px-4 py-2 border-r border-gray-500">Details</th>
                  <th id="action" class="px-4 py-2">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of resultNCR; let i = index" class="border-b border-gray-500">
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.proposed_close_auditee }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.proposed_close_date }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.is_close }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.effectiveness }}</td>
                  <td class="px-4 py-2 border-r border-gray-500">{{ item.new_ncr_issue_nbr }}</td>
                  <td class="px-4 py-2 border-r border-gray-500 text-center">
                    <details id="result_details_{{i+1}}" class="open">
                      <summary class="inline-block bg-[#016299] rounded border-2 border-primary px-4 pb-[6px] pt-2 text-xs font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 cursor-pointer focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
                        Details
                      </summary>

                      <div class="bg-white outline outline-1 outline-gray-700 rounded-lg w-fit max-w-[60%] h-fit my-auto mx-auto fixed inset-0 text-gray-600 p-16">
                        <span (click)="closeDetails('result_details_' + (i+1))"
                            class="bg-gray-400 rounded-full flex items-center justify-center text-3xl font-bold uppercase absolute -right-4 -top-4 w-10 h-10 text-white hover:bg-blue-200 hover:duration-200 cursor-pointer">
                            X
                        </span>
                        <div class="grid grid-cols-2 gap-4">
                          <div class="col-span-2 space-y-2">
                            <label class="block tracking-wide text-gray-700 text-base font-semibold text-left">Root Cause of Problem:</label>
                            <p class="tracking-wide text-gray-600 text-base text-left">{{item.close_corrective_actions}}</p>
                          </div>
                          <div class="space-x-2 text-left">
                            <label class="tracking-wide text-gray-700 text-base font-semibold text-left">Approved by:</label>
                            <label class="tracking-wide text-gray-600 text-base text-left">{{item.close_approved_by}}</label>
                          </div>
                          <div class="space-x-2 text-left">
                            <label class="tracking-wide text-gray-700 text-base font-semibold text-left">Verified by:</label>
                            <label class="tracking-wide text-gray-600 text-base text-left">{{item.verified_chief_im}}</label>
                          </div>
                          <div class="space-x-2 text-left">
                            <label class="tracking-wide text-gray-700 text-base font-semibold text-left">Approved Date:</label>
                            <label class="tracking-wide text-gray-600 text-base text-left">{{item.close_approved_date}}</label>
                          </div>
                          <div class="space-x-2 text-left">
                            <label class="tracking-wide text-gray-700 text-base font-semibold text-left">Verified Date:</label>
                            <label class="tracking-wide text-gray-600 text-base text-left">{{item.verified_date}}</label>
                          </div>
                          <div class="space-x-2 text-left">
                            <label class="tracking-wide text-gray-700 text-base font-semibold text-left">Reference Verification:</label>
                            <label class="tracking-wide text-gray-600 text-base text-left">{{item.refer_verification}}</label>
                          </div>
                          <div class="space-x-2 text-left">
                            <label class="tracking-wide text-gray-700 text-base font-semibold text-left">Sheet Number:</label>
                            <label class="tracking-wide text-gray-600 text-base text-left">{{item.sheet_no}}</label>
                          </div>
                        </div>
                    </div>
                    </details>
                  </td>
                  <td class="px-4 py-2 text-center">
                    <!-- <button (click)="navigatePreview(replyNCR.documentid)" class="inline-block bg-[#016299] rounded border-2 border-primary px-3 pb-[6px] pt-2 text-xs font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">Preview</button> -->
                    <button (click)="navigateEditResult(item.id_ncr_result)" class="inline-block bg-[#016299] rounded border-2 border-primary px-4 pb-[6px] pt-2 text-xs font-medium uppercase leading-normal text-primary transition duration-150 ease-in-out hover:border-primary-accent-300 hover:bg-primary-50/50 hover:text-primary-accent-300 focus:border-primary-600 focus:bg-primary-50/50 focus:text-primary-600 focus:outline-none focus:ring-0 active:border-primary-700 active:text-primary-700 motion-reduce:transition-none dark:text-primary-500 dark:hover:bg-blue-950 dark:focus:bg-blue-950 text-white">
                      <i class="fas fa-edit" style="font-size: 12px;"></i> Edit
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="flex mt-4 justify-center">
          <details id="export_excel_result" class="w-fit open">
            <summary (click)="exportToExcel('export-result-table')" class="inline-block text-white justify-center bg-[#107c41] hover:bg-[#185c37] focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg px-4 py-2 motion-reduce:transition-none cursor-pointer">
              <i class="fas fa-file-excel text-white mr-2"></i>Export to Excel
            </summary>
  
            <div class="hidden bg-white outline outline-1 outline-gray-700 rounded-lg w-fit max-w-[80%] h-fit my-auto mx-auto fixed inset-0 text-gray-600 p-16">
              <div class="show-table mt-5 border border-gray-500">
                <div class="table-responsive overflow-auto" style="max-height: 600px; min-height: 200px;">
                  <table class="table w-full bg-white overflow-y-scroll text-sm" id="export-result-table">
                    <thead class="bg-blue-100 font-medium">
                      <tr class="border-b border-gray-500">
                        <th id="proposed_close_auditee" class="px-4 py-2 border-r border-gray-500">Close Proposed by</th>
                        <th id="proposed_close_date" class="px-4 py-2 border-r border-gray-500">Close Proposed Date</th>
                        <th id="close_corrective_actions" class="px-4 py-2 border-r border-gray-500">Close Corrective Actions</th>
                        <th id="refer_verification" class="px-4 py-2 border-r border-gray-500">Reference Verification</th>
                        <th id="is_close" class="px-4 py-2 border-r border-gray-500">Close</th>
                        <th id="effectiveness" class="px-4 py-2 border-r border-gray-500">Effectiveness</th>
                        <th id="close_approved_by" class="px-4 py-2 border-r border-gray-500">Approved by</th>
                        <th id="close_approved_date" class="px-4 py-2 border-r border-gray-500">Approved Date</th>
                        <th id="verified_chief_im" class="px-4 py-2 border-r border-gray-500">Verified by</th>
                        <th id="verified_date" class="px-4 py-2 border-r border-gray-500">Verified Date</th>
                        <th id="new_ncr_issue_nbr" class="px-4 py-2">New NCR Issue Number</th>
                        <th id="sheet_no" class="px-4 py-2">Sheet Number</th>
                        <th id="temporarylink" class="px-4 py-2">Temporary Link</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of resultNCR" class="border-b border-gray-500">
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.proposed_close_auditee }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.proposed_close_date }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.close_corrective_actions }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.refer_verification }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.is_close }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.effectiveness }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.close_approved_by }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.close_approved_date }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.verified_chief_im }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.verified_date }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.new_ncr_issue_nbr }}</td>
                        <td class="px-4 py-2 border-r border-gray-500">{{ item.sheet_no }}</td>
                        <td class="px-4 py-2">{{ item.temporarylink }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>